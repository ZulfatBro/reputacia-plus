<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Простой звонок WebRTC</title>
</head>
<body>
  <h2>Звонок другу (P2P WebRTC)</h2>

  <button id="startBtn">Создать звонок</button><br><br>

  <textarea id="offer" placeholder="Тут будет Offer..." style="width:100%;height:100px"></textarea><br>
  <button id="copyOffer">Скопировать Offer</button><br><br>

  <textarea id="answer" placeholder="Вставьте сюда Answer друга..." style="width:100%;height:100px"></textarea><br>
  <button id="setAnswer">Установить Answer</button><br><br>

  <button id="answerBtn">Ответить на звонок</button><br><br>
  <textarea id="remoteOffer" placeholder="Вставьте сюда Offer друга..." style="width:100%;height:100px"></textarea><br>
  <button id="createAnswer">Создать Answer</button><br><br>
  <textarea id="myAnswer" placeholder="Скопируйте этот Answer другу..." style="width:100%;height:100px"></textarea><br>

  <script>
    let pc = new RTCPeerConnection();
    let localStream;

    // Включаем микрофон
    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
      localStream = stream;
      stream.getTracks().forEach(track => pc.addTrack(track, stream));
    });

    // Воспроизводим звук друга
    pc.ontrack = e => {
      let audio = document.createElement("audio");
      audio.srcObject = e.streams[0];
      audio.autoplay = true;
      document.body.appendChild(audio);
    };

    // Создать звонок (Offer)
    document.getElementById("startBtn").onclick = async () => {
      let offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
      document.getElementById("offer").value = JSON.stringify(offer);
    };

    // Скопировать Offer
    document.getElementById("copyOffer").onclick = () => {
      navigator.clipboard.writeText(document.getElementById("offer").value);
    };

    // Установить Answer
    document.getElementById("setAnswer").onclick = async () => {
      let answer = JSON.parse(document.getElementById("answer").value);
      await pc.setRemoteDescription(new RTCSessionDescription(answer));
      alert("Answer установлен, звонок работает!");
    };

    // Ответить на звонок
    document.getElementById("answerBtn").onclick = async () => {
      let remoteOffer = JSON.parse(document.getElementById("remoteOffer").value);
      await pc.setRemoteDescription(new RTCSessionDescription(remoteOffer));
      let answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);
      document.getElementById("myAnswer").value = JSON.stringify(answer);
    };
  </script>
</body>
</html>
